<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emotional Intelligence Companion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            transition: opacity 0.3s ease;
        }
        
        #mainContainer {
            max-width: 800px;
            margin: 20px auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            transition: opacity 0.3s ease;
        }
        
        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 5px;
            font-weight: 700;
            letter-spacing: 2px;
        }
        
        .header .subheading {
            font-size: 1.2rem;
            opacity: 0.9;
            font-weight: 400;
            margin-top: 10px;
        }
        
        .main-content {
            padding: 40px;
        }
        
        .input-section h2 {
            color: #1f2937;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        textarea {
            width: 100%;
            padding: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
            min-height: 120px;
            transition: all 0.3s ease;
        }
        
        textarea:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        .process-btn {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 16px 40px;
            font-size: 1.1rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-top: 15px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .process-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(79, 70, 229, 0.3);
        }
        
        .process-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .pause-section {
            margin-top: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 16px;
            text-align: center;
        }
        
        .pause-heading {
            font-size: 3rem;
            color: #4f46e5;
            font-weight: 700;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }
        
        .pause-subheading {
            font-size: 1.2rem;
            color: #374151;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        .pause-description {
            color: #6b7280;
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
            font-size: 0.95rem;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #6b7280;
            font-size: 0.9rem;
            border-top: 1px solid #f3f4f6;
        }
        
        /* Response modal */
        #responseModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            max-width: 600px;
            margin: 40px auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            animation: slideUp 0.4s ease;
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .response-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f3f4f6;
        }
        
        .response-header h2 {
            color: #4f46e5;
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        
        .response-body {
            font-size: 1.1rem;
            line-height: 1.7;
            color: #374151;
        }
        
        .response-section {
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 12px;
            transition: transform 0.2s ease;
        }
        
        .response-section:hover {
            transform: translateX(5px);
        }
        
        .response-section.understanding {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-left: 4px solid #4f46e5;
        }
        
        .response-section.body {
            background: linear-gradient(135deg, #fefce8 0%, #fef9c3 100%);
            border-left: 4px solid #f59e0b;
        }
        
        .response-section.purpose {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-left: 4px solid #10b981;
        }
        
        .response-section.shared {
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
            border-left: 4px solid #8b5cf6;
        }
        
        .response-section h3 {
            font-size: 1.1rem;
            margin-bottom: 12px;
            color: #1f2937;
            font-weight: 600;
        }
        
        .closure {
            margin-top: 40px;
            padding: 25px;
            border-radius: 12px;
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            text-align: center;
            color: #059669;
            font-style: italic;
            font-size: 1.2rem;
            border: 2px dashed #10b981;
        }
        
        .continue-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 16px 40px;
            font-size: 1.1rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-top: 30px;
            width: 100%;
            display: block;
        }
        
        .continue-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
        }
        
        @media (max-width: 640px) {
            #mainContainer {
                margin: 10px;
                border-radius: 16px;
            }
            
            .header, .main-content {
                padding: 25px;
            }
            
            .header h1, .pause-heading {
                font-size: 2.5rem;
            }
            
            .modal-content {
                padding: 25px;
                margin: 20px auto;
            }
        }
    </style>
</head>
<body>
    <!-- Main Interface -->
    <div id="mainContainer">
        <div class="header">
            <h1>PAUSE</h1>
            
            <p style="margin-top: 15px; opacity: 0.8;">A quiet moment to notice what‚Äôs happening.</p>
        </div>
        
        <div class="main-content">
            <div class="input-section">
                <h2>What are you feeling right now?</h2>
                <textarea id="userInput" placeholder="Anxious, Heavy, Something feels off......"></textarea>
                <button id="processBtn" class="process-btn">
                    <span>Show me what‚Äôs happening</span>
                </button>
            </div>
            
            <div class="pause-section">
                <div class="pause-subheading">These responses come from protection.
                   Understanding allows the system to return to safety.</div>
                <p class="pause-description">
                    Each response uses clear, simple words.
It offers understanding while keeping space.
                </p>
            </div>
        </div>
        
        <div class="footer">
            <p>¬© Manisha Kinger 2026</p>
        </div>
    </div>
    
    <!-- Response Modal -->
    <div id="responseModal">
        <div class="modal-content">
            <div class="response-header">
                <h2 id="emotionTitle">Understanding Your Experience</h2>
                <p style="color: #6b7280; font-size: 0.95rem;">Based on what you shared</p>
            </div>
            
            <div id="responseContent" class="response-body">
                <!-- Response will be dynamically inserted here -->
            </div>
            
            <button id="continueBtn" class="continue-btn">
                Continue Your Day
            </button>
        </div>
    </div>

    <script>
        <script>
    // ‚úÖ BACKEND-CONNECTED VERSION
    // Configured for Emotional Intelligence Companion
    
    document.addEventListener('DOMContentLoaded', function() {
        // üéØ CONFIGURATION - UPDATE THIS WITH YOUR BACKEND URL
        const API_BASE_URL = 'https://emotional-companion-api1.onrender.com/api; 
        // Example: 'https://emotional-companion-api1.onrender.com/api'
        // Example: 'https://your-backend.railway.app/api'
        
        // DOM Elements
        const userInput = document.getElementById('userInput');
        const processBtn = document.getElementById('processBtn');
        const mainContainer = document.getElementById('mainContainer');
        const responseModal = document.getElementById('responseModal');
        const responseContent = document.getElementById('responseContent');
        const continueBtn = document.getElementById('continueBtn');
        const emotionTitle = document.getElementById('emotionTitle');
        
        // State management
        let isProcessing = false;
        
        // ‚ú® FUNCTION: Generate HTML from backend response
        function generateResponseHTML(response) {
            // Check if response is valid
            if (!response || !response.sections || !Array.isArray(response.sections)) {
                return generateErrorHTML("The response format was unexpected. Thank you for sharing.");
            }
            
            // Generate sections HTML
            const sectionsHTML = response.sections.map(section => {
                // Determine CSS class based on section type
                const sectionClass = section.type || 'understanding';
                return `
                    <div class="response-section ${sectionClass}">
                        <h3>${section.title || 'Understanding'}</h3>
                        <p>${section.content || ''}</p>
                    </div>
                `;
            }).join('');
            
            // Return complete HTML structure
            return `
                ${sectionsHTML}
                <div class="closure">
                    ${response.closure || "You can continue your day."}
                </div>
            `;
        }
        
        // ‚ùå FUNCTION: Generate error HTML
        function generateErrorHTML(message = "Something went wrong") {
            return `
                <div class="response-section understanding">
                    <h3>Thank You For Sharing</h3>
                    <p>${message}</p>
                </div>
                
                <div class="response-section shared">
                    <h3>You're Not Alone</h3>
                    <p>Many people have moments that are hard to put into words. That's part of being human.</p>
                </div>
                
                <div class="closure">
                    You can continue your day.
                </div>
            `;
        }
        
        // üé≠ FUNCTION: Show response modal
        function showResponse(responseHTML, title = "Understanding Your Experience") {
            // Update title
            emotionTitle.textContent = title;
            
            // Hide main interface with fade
            mainContainer.style.opacity = '0';
            
            setTimeout(() => {
                mainContainer.style.display = 'none';
                
                // Show response modal
                responseContent.innerHTML = responseHTML;
                responseModal.style.display = 'block';
                
                // Animate sections in
                setTimeout(() => {
                    const sections = document.querySelectorAll('.response-section');
                    sections.forEach((section, index) => {
                        setTimeout(() => {
                            section.style.opacity = '1';
                            section.style.transform = 'translateY(0)';
                        }, index * 100);
                    });
                }, 100);
            }, 300);
        }
        
        // üîÑ FUNCTION: Reset to main interface
        function resetInterface() {
            // Hide response modal
            responseModal.style.display = 'none';
            
            // Show main interface
            mainContainer.style.display = 'block';
            
            setTimeout(() => {
                mainContainer.style.opacity = '1';
                processBtn.innerHTML = '<span>Show me what\'s happening</span>';
                processBtn.disabled = false;
                isProcessing = false;
                userInput.focus();
            }, 10);
        }
        
        // üåê FUNCTION: Call backend API
        async function callAPI(endpoint, method = 'GET', data = null) {
            const url = `${API_BASE_URL}${endpoint}`;
            
            const options = {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                mode: 'cors'
            };
            
            if (data && (method === 'POST' || method === 'PUT')) {
                options.body = JSON.stringify(data);
            }
            
            try {
                const response = await fetch(url, options);
                
                // Check if response is ok
                if (!response.ok) {
                    let errorMessage = `HTTP ${response.status}`;
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.error || errorData.message || errorMessage;
                    } catch (e) {
                        // Could not parse JSON error response
                    }
                    throw new Error(errorMessage);
                }
                
                // Parse successful response
                return await response.json();
                
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }
        
        // üéØ EVENT: Process button click
        processBtn.addEventListener('click', async function handleProcess() {
            // Prevent multiple simultaneous requests
            if (isProcessing) {
                return;
            }
            
            const input = userInput.value.trim();
            
            // ‚úÖ Input validation
            if (!input) {
                alert("Please share what's on your mind. Whatever you're feeling or thinking matters.");
                return;
            }
            
            if (input.length < 3) {
                alert("Please share a bit more so we can understand your experience better.");
                return;
            }
            
            if (input.length > 1000) {
                alert("Please share a more focused experience (maximum 1000 characters).");
                return;
            }
            
            // Set processing state
            isProcessing = true;
            processBtn.innerHTML = '<div class="spinner"></div><span>Listening and understanding...</span>';
            processBtn.disabled = true;
            
            try {
                // Call backend API
                console.log('Sending to backend:', input.substring(0, 50) + '...');
                const response = await callAPI('/process', 'POST', { 
                    text: input 
                });
                
                console.log('Backend response received');
                
                // Generate HTML from API response
                const responseHTML = generateResponseHTML(response);
                
                // Show response
                showResponse(responseHTML, response.title || "Understanding Your Experience");
                
                // Clear input for next interaction
                userInput.value = '';
                
            } catch (error) {
                console.error('Error in processing:', error);
                
                // Determine error message
                let errorMessage = "I understand you're sharing something significant. Please try again.";
                
                if (error.message.includes('Failed to fetch') || error.message.includes('Network')) {
                    errorMessage = "Unable to connect to the backend server. The system is using local processing.";
                    // Fallback to local processing
                    fallbackToLocalProcessing(input);
                    return;
                } else if (error.message.includes('400')) {
                    errorMessage = "Please share your thoughts in a different way.";
                } else if (error.message.includes('429')) {
                    errorMessage = "Please wait a moment before sharing again.";
                }
                
                // Show error response
                const errorResponse = generateErrorHTML(errorMessage);
                showResponse(errorResponse, "Thank You For Sharing");
                
                // Clear input
                userInput.value = '';
                
            } finally {
                // Reset button if modal isn't showing
                if (responseModal.style.display === 'none') {
                    processBtn.innerHTML = '<span>Show me what\'s happening</span>';
                    processBtn.disabled = false;
                    isProcessing = false;
                }
            }
        });
        
        // üîÑ FUNCTION: Fallback to local processing if backend fails
        function fallbackToLocalProcessing(input) {
            try {
                // Your existing frontend emotional states and matching logic
                const emotionalStates = {
                    worry_future: {
                        title: "When Things Feel Uncertain",
                        understanding: "That sense of looking ahead and wondering what might come ‚Äì it's like your mind is trying to prepare for all possibilities. Many people feel this way when facing unknowns.",
                        body: "Your body might be showing signs of this through a faster heartbeat, tight shoulders, or that feeling in your stomach. It's your system's way of getting ready.",
                        purpose: "This response has helped humans stay alert and prepare for challenges throughout our history. It's part of how we've survived uncertain times.",
                        shared: "Across cultures, people experience this before important events or decisions. It's a shared human experience of preparing for what's ahead.",
                        closure: "You can continue your day."
                    },
                    // ... include all your other emotional states from your original code
                };
                
                // Simple matching logic for fallback
                const text = input.toLowerCase();
                let matchedEmotion = 'peace_integration';
                
                if (text.includes('anxious') || text.includes('worried') || text.includes('nervous')) {
                    matchedEmotion = 'worry_future';
                } else if (text.includes('sad') || text.includes('miss') || text.includes('lost')) {
                    matchedEmotion = 'sadness_loss';
                } else if (text.includes('frustrated') || text.includes('stuck') || text.includes('can\'t')) {
                    matchedEmotion = 'frustration_blocked';
                } else if (text.includes('happy') || text.includes('joy') || text.includes('excited')) {
                    matchedEmotion = 'joy_connection';
                } else if (text.includes('confused') || text.includes('don\'t understand')) {
                    matchedEmotion = 'confusion_learning';
                }
                
                const state = emotionalStates[matchedEmotion] || emotionalStates['peace_integration'];
                
                const responseHTML = `
                    <div class="response-section understanding">
                        <h3>Understanding This Feeling</h3>
                        ${state.understanding}
                    </div>
                    
                    <div class="response-section body">
                        <h3>What Your Experience Might Feel Like</h3>
                        ${state.body}
                    </div>
                    
                    <div class="response-section purpose">
                        <h3>Why Humans Experience This</h3>
                        ${state.purpose}
                    </div>
                    
                    <div class="response-section shared">
                        <h3>How Others Experience This Too</h3>
                        ${state.shared}
                    </div>
                    
                    <div class="closure">
                        ${state.closure}
                    </div>
                `;
                
                showResponse(responseHTML, state.title);
                userInput.value = '';
                
            } catch (fallbackError) {
                console.error('Fallback error:', fallbackError);
                const errorResponse = generateErrorHTML("Thank you for sharing. What you're experiencing matters.");
                showResponse(errorResponse, "Thank You For Sharing");
                userInput.value = '';
            } finally {
                processBtn.innerHTML = '<span>Show me what\'s happening</span>';
                processBtn.disabled = false;
                isProcessing = false;
            }
        }
        
        // üîÑ EVENT: Continue button
        continueBtn.addEventListener('click', resetInterface);
        
        // ‚å®Ô∏è EVENT: Enter key support
        userInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                if (!isProcessing) {
                    processBtn.click();
                }
            }
        });
        
        // üéØ Initialize
        userInput.focus();
        
        // üåê Optional: Test backend connection on load
        function testBackendConnection() {
            if (API_BASE_URL && API_BASE_URL !== 'YOUR_BACKEND_URL_HERE/api') {
                callAPI('/health')
                    .then(data => {
                        console.log('‚úÖ Backend connected:', data.status, '-', data.service);
                        console.log('üåê Frontend configured:', data.frontend);
                    })
                    .catch(error => {
                        console.warn('‚ö†Ô∏è Backend not available:', error.message);
                        console.log('‚ö†Ô∏è Frontend will use fallback processing when needed');
                    });
            }
        }
        
        // Uncomment to test backend connection on page load
        // testBackendConnection();
    });
</script>
  
</body>
</html>
